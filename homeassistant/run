#!/usr/bin/with-contenv bashio
# ==============================================================================
# Start Home Assistant service
# ==============================================================================

# Changed to point the config directory to pepersistent storage on a balena device
if [ -d /persistent ]; then
    mkdir -p /persistent/homeassistant
    rm -rf /config && ln -sf /persistent/homeassistant /config 
fi
# end of changes

cd /config || bashio::exit.nok "Can't find config folder!"

# Enable Jemalloc for Home Assistant Core, unless disabled
if [[ -z "${DISABLE_JEMALLOC+x}" ]]; then
  export LD_PRELOAD="/usr/local/lib/libjemalloc.so.2"
fi
exec python3 -m homeassistant --config /config
